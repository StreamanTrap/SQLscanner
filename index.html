<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∫–∞–Ω–µ—Ä SQL-–∏–Ω—ä–µ–∫—Ü–∏–π</title>
    
    <!-- –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è GitHub Pages/PythonAnywhere -->
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="./static/style.css">
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è –°–∫–∞–Ω–µ—Ä —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π</h1>
        <p class="subtitle">–ü—Ä–æ–≤–µ—Ä–∫–∞ SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –∏ XSS</p>
        
        <div class="input-group">
            <div class="input-wrapper">
                <input type="url" id="url-input" 
                       placeholder="https://testphp.vulnweb.com/artists.php?artist=1" 
                       value="">
                <span class="input-icon">üîó</span>
            </div>
            <button id="scan-btn" class="btn-primary">üöÄ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
            <button id="stop-btn" class="btn-danger" style="display: none;">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        </div>
        
        <div id="status-message" class="status-message hidden"></div>
        
        <div id="progress-container" class="progress-container hidden">
            <div class="progress-header">
                <span>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...</span>
                <span id="scan-id-display"></span>
            </div>
            <div class="progress-wrapper">
                <div id="progress-bar" class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
            </div>
            <p id="progress-text">0%</p>
            <div id="current-target" class="current-target"></div>
        </div>
        
        <div id="results-container" class="results-container hidden">
            <div class="results-header">
                <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                <button id="new-scan-btn" class="btn-secondary">üîÑ –ù–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            </div>
            <div id="results-content" class="results-content"></div>
        </div>
    </div>

    <!-- –†–µ–∑–µ—Ä–≤–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è JS -->
    <script src="/static/script.js"></script>
    <script src="./static/script.js"></script>
    <script>
        // Inline JS –∫–∞–∫ fallback - —Å—Ä–∞–∑—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã');
            
            const urlInput = document.getElementById('url-input');
            const scanBtn = document.getElementById('scan-btn');
            const stopBtn = document.getElementById('stop-btn');
            
            if (!urlInput || !scanBtn || !stopBtn) {
                console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!');
                return;
            }
            
            console.log('–≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–Ω–µ—à–Ω–∏–π JS –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
            const script = document.createElement('script');
            script.src = '/static/script.js';
            script.onerror = function() {
                console.log('–í–Ω–µ—à–Ω–∏–π JS –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, –∏—Å–ø–æ–ª—å–∑—É—é inline');
                initInlineScanner();
            };
            document.head.appendChild(script);
            
            function initInlineScanner() {
                console.log('Inline —Å–∫–∞–Ω–µ—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
                
                scanBtn.addEventListener('click', async function() {
                    const url = urlInput.value.trim();
                    if (!url) {
                        showStatus('–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!', 'error');
                        return;
                    }
                    
                    try {
                        showProgress(0, url);
                        scanBtn.style.display = 'none';
                        stopBtn.style.display = 'inline-block';
                        
                        const response = await fetch('/api/scan_web', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({url: url})
                        });
                        
                        const result = await response.json();
                        hideProgress();
                        scanBtn.style.display = 'inline-block';
                        stopBtn.style.display = 'none';
                        
                        if (result.results && result.results.success) {
                            showResults(result.results);
                        } else {
                            showStatus(result.error || '–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞:', error);
                        showStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                        hideProgress();
                        scanBtn.style.display = 'inline-block';
                        stopBtn.style.display = 'none';
                    }
                });
                
                stopBtn.addEventListener('click', async function() {
                    try {
                        await fetch('/api/stop_scan', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({scan_id: document.getElementById('scan-id-display')?.textContent || ''})
                        });
                        hideProgress();
                        scanBtn.style.display = 'inline-block';
                        stopBtn.style.display = 'none';
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:', error);
                    }
                });
            }
            
            function showStatus(message, type = 'info') {
                const statusEl = document.getElementById('status-message');
                statusEl.textContent = message;
                statusEl.className = `status-message ${type}`;
                statusEl.classList.remove('hidden');
            }
            
            function showProgress(percent, target) {
                document.getElementById('progress-container').classList.remove('hidden');
                document.getElementById('progress-text').textContent = `${percent}%`;
                document.getElementById('progress-bar').querySelector('.progress-fill').style.width = `${percent}%`;
                if (target) {
                    document.getElementById('current-target').textContent = `–¶–µ–ª—å: ${target}`;
                }
            }
            
            function hideProgress() {
                document.getElementById('progress-container').classList.add('hidden');
            }
            
            function showResults(data) {
                document.getElementById('results-container').classList.remove('hidden');
                const content = document.getElementById('results-content');
                content.innerHTML = `
                    <div class="summary">
                        <span class="vuln-count">${data.vulnerabilities_found || 0}</span>
                        <span>—É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –Ω–∞–π–¥–µ–Ω–æ</span>
                    </div>
                    <div id="issues-list"></div>
                `;
            }
        });
    </script>
</body>
</html>
